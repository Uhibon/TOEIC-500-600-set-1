<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>TOEIC (500-600) set-1 ‚Äì Boo-riculum</title>
  <link rel="icon" type="image/png" href="booha-ghost.png">
  <style>
    :root { --ink:#222; --muted:#444; --accent:#0b78ff; --ok:#22c55e; --bad:#ef4444; }
    html,body{height:100%; margin:0;}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:url('Booha card.jpg') center/cover fixed no-repeat;
      overflow:hidden; /* lock page so the card never cuts off from page scroll */
    }
    /* Full-height app frame */
    .wrap{
      height:100%;
      max-width:900px;
      margin:0 auto;
      padding: max(10px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right))
               max(10px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      display:flex;
      flex-direction:column;
      gap:10px;
      box-sizing:border-box;
    }
    header{
      display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;
      background:rgba(255,255,255,0.88);padding:12px 16px;
      border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.15)
    }
    header h1{
      font-size:18px;margin:0;font-weight:800;letter-spacing:.3px;
      background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      display:flex;align-items:center;gap:8px
    }
    header h1 img{height:28px;width:auto;}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    select,button{
      background:rgba(255,255,255,0.95);color:var(--ink);border:1px solid #ccc;
      border-radius:12px;padding:10px 12px;font-size:14px;
      box-shadow:0 2px 5px rgba(0,0,0,0.08)
    }
    button{cursor:pointer;transition:transform .05s ease, background .2s}
    button:hover{background:#f0f0f0}
    button:active{transform:scale(.98)}
    .pill{border:1px solid #ccc;border-radius:999px;padding:6px 10px;font-size:12px;background:rgba(255,255,255,0.7)}
    /* Card auto-fits between header and footer */
    .card{
      flex:1 1 auto;
      min-height:0; /* allow flex shrink */
      user-select:none;-webkit-user-select:none;
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      text-align:center;background:url('Booha card.jpg') center/cover no-repeat;
      border:1px solid #ccc;border-radius:24px;padding:16px 16px 20px;margin:0;
      box-shadow:0 10px 40px rgba(0,0,0,.25); position:relative;
      overflow:hidden;
    }
    .brand{
      position:absolute;top:10px;left:12px;display:flex;gap:8px;align-items:center;
      background:rgba(255,255,255,0.85);padding:6px 10px;border-radius:12px;border:1px solid #ddd;
      box-shadow:0 2px 6px rgba(0,0,0,0.08); font-weight:800; letter-spacing:.2px;
    }
    .brand img{height:20px;width:auto}
    .brand span{background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .label{color:var(--muted);font-size:13px;letter-spacing:.3px;margin-bottom:8px;
      background:rgba(255,255,255,0.7);padding:4px 8px;border-radius:8px}

    /* Picture block ‚Äì NO CROPPING (contain), scales to fit card */
    .picture{
      display:block;
      width:min(96%, 860px);
      max-height:52vh;        /* keep footer visible on small screens */
      height:auto;
      object-fit:contain;      /* <- key change: never crop */
      border-radius:16px;
      border:1px solid #ddd;
      box-shadow:0 6px 18px rgba(0,0,0,.15);
      background:#fff;
      margin:6px auto 12px;
    }

    .main{font-size:28px;line-height:1.25;font-weight:800;margin:8px 0 10px;
      background:rgba(255,255,255,0.86);padding:8px 12px;border-radius:12px}
    .sub{font-size:18px;opacity:.92;margin:0 0 6px;background:rgba(255,255,255,0.65);
      padding:4px 10px;border-radius:8px}
    .hira{font-size:18px;color:var(--accent);opacity:.95;background:rgba(255,255,255,0.75);
      padding:4px 10px;border-radius:8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center}
    .footer{
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:space-between;margin-top:8px;color:var(--muted);font-size:13px;
      background:rgba(255,255,255,0.85);padding:8px 12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)
    }
    .progress{height:8px;border-radius:999px;background:#eee;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);width:0%}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
    @media (max-width:700px){
      .grid{grid-template-columns:repeat(2,minmax(0,1fr));}
      .main{font-size:24px}
    }
    a{color:#0b78ff;text-decoration:none}
    .hidden{display:none}
    .options{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .optbtn{border:1px solid #ccc;border-radius:12px;padding:10px 14px;background:rgba(255,255,255,0.95);cursor:pointer}
    .optbtn.ok{background:#dcfce7;border-color:#86efac;color:#166534}
    .optbtn.bad{background:#fee2e2;border-color:#fca5a5;color:#991b1b}
    .small{font-size:15px; line-height:1.45;}

    /* QA audio controls */
    .qaOnly{display:none}
    .playBtn{ background:#ef4444;color:#fff;border-color:#dc2626;font-weight:800; }
    .playBtn.paused::after{content:' ‚ñ∂Ô∏é';}
    .playBtn.playing::after{content:' ‚Ö°';}
    .speedBtn{min-width:74px;text-align:center}

    /* Simple welcome overlay kept minimal */
    .welcomeOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:50;background:linear-gradient(180deg,rgba(255,255,255,.92),rgba(255,255,255,.86));}
    .welcomeCard{max-width:720px;width:min(92%,720px);text-align:center;background:rgba(255,255,255,0.96);border:1px solid #ddd;border-radius:24px;box-shadow:0 12px 40px rgba(0,0,0,.18);padding:28px}
    .welcomeCard img{width:96px;height:auto;margin:8px auto 12px;display:block}
    .welcomeCard h2{margin:6px 0 10px;font-size:24px}
    .welcomeCard p{margin:6px 0 14px;font-size:16px;color:#333}
    .startBtn{background:#0b78ff;color:#fff;border:0;padding:12px 18px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(11,120,255,.25)}
  </style>
</head>
<body>
  <!-- Welcome -->
  <div id="welcome" class="welcomeOverlay">
    <div class="welcomeCard">
      <img src="booha-ghost.png" alt="Booha ghost">
      <h2>„Çà„ÅÜ„Åì„ÅùÔºöTOEICÔºà500„Äú600Ôºâ„Çª„ÉÉ„Éà1</h2>
      <p>Welcome to TOEIC (500‚Äì600) set 1</p>
      <button id="startBtn" class="startBtn">Start / „ÅØ„Åò„ÇÅ„Çã</button>
    </div>
  </div>

  <div class="wrap hidden" id="app">
    <header>
      <h1><img src="booha-ghost.png" alt=""> Boo-riculum ‚Äì TOEIC (500-600) set-1</h1>
      <div class="controls">
        <select id="mode" aria-label="Mode">
          <option value="vocab-j2e">Vocab: üáØüáµ ‚Üí üá∫üá∏</option>
          <option value="vocab-e2j">Vocab: üá∫üá∏ ‚Üí üáØüáµ</option>
          <option value="sentences">Sentences (practice)</option>
          <option value="qa" selected>Questions (practice)</option>
          <option value="quiz">Quiz (multiple choice)</option>
          <option value="reading">Reading</option>
        </select>
      </div>
    </header>

    <div id="card" class="card" role="button" aria-label="flashcard" tabindex="0">
      <div class="brand"><img src="booha-ghost.png" alt="Booha ghost"><span>Boo-riculum</span></div>
      <div id="label" class="label">Front</div>

      <!-- Picture slot -->
      <img id="pic" class="picture hidden" alt="illustration">

      <div id="main" class="main">‚Äî</div>
      <div id="sub" class="sub muted">Tap or press Space to flip</div>
      <div id="hira" class="hira hidden"></div>
      <div id="mcArea" class="options hidden"></div>
    </div>

    <div class="footer">
      <div class="row">
        <span class="pill" title="Left / Right keys">Keyboard: ‚Üê ‚Üí</span>
        <span class="pill" title="Space to flip">Space = Flip</span>
        <button id="btnPrev" title="‚Üê or swipe right">‚óÄÔ∏é Prev</button>
        <button id="btnFlip" title="Tap / Space">Flip</button>
        <button id="btnNext" title="‚Üí or swipe left">Next ‚ñ∂Ô∏é</button>
        <button id="btnShuffle" title="Shuffle deck">Shuffle</button>

        <!-- QA audio controls -->
        <button id="btnPlay" class="playBtn qaOnly paused" title="Play/Pause (QA audio)">Play</button>
        <button id="btnSpeed" class="speedBtn qaOnly" title="Toggle speed">1.0√ó</button>
      </div>
      <div style="min-width:180px;text-align:right">
        <div id="counter" class="muted">0 / 0</div>
        <div class="progress" aria-hidden="true"><span id="bar"></span></div>
      </div>
    </div>

    <!-- Hidden audio element for QA -->
    <audio id="qaAudio" preload="metadata" playsinline></audio>
  </div>

  <script>
    // ---------- Tiny helper (kept) ----------
    function svg(label, emoji){
      const base = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 675'>
        <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
          <stop offset='0%' stop-color='#eaf3ff'/><stop offset='100%' stop-color='#f7e9ff'/></linearGradient></defs>
        <rect width='1200' height='675' fill='url(#g)'/>
        <rect x='60' y='60' width='1080' height='555' rx='28' fill='white' stroke='#d7d7d7'/>
        <text x='600' y='320' font-size='144' text-anchor='middle' dominant-baseline='central'>${emoji||'üíº'}</text>
        <text x='600' y='520' font-size='40' text-anchor='middle' fill='#333' font-family='Inter,Segoe UI,Arial,sans-serif'>${label}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + base.replace(/\n/g,'');
    }

    // ---------------- Data ----------------
    const VOCAB = [
      { en:"accomplish", ja:"ÈÅîÊàê„Åô„Çã" }, { en:"allocate", ja:"Ââ≤„ÇäÂΩì„Å¶„Çã" },
      { en:"approximately", ja:"„Åä„Çà„ÅùÔºèÁ¥Ñ" }, { en:"assemble", ja:"ÁµÑ„ÅøÁ´ã„Å¶„ÇãÔºõÈõÜ„ÇÅ„Çã" },
      { en:"assume", ja:"‰ªÆÂÆö„Åô„ÇãÔºõÂºï„ÅçÂèó„Åë„Çã" }, { en:"authorize", ja:"ÊâøË™ç„Åô„ÇãÔºõË™çÂèØ„Åô„Çã" },
      { en:"capacity", ja:"ËÉΩÂäõÔºõÂèéÂÆπËÉΩÂäõ" }, { en:"cautious", ja:"Áî®ÂøÉÊ∑±„ÅÑÔºõÊÖéÈáç„Å™" },
      { en:"clarify", ja:"ÊòéÁ¢∫„Å´„Åô„Çã" }, { en:"collaborate", ja:"ÂçîÂäõ„Åô„ÇãÔºõÂÖ±Âêå„ÅßË°å„ÅÜ" },
      { en:"compile", ja:"„Åæ„Å®„ÇÅ„ÇãÔºõÁ∑®ÈõÜ„Åô„Çã" }, { en:"confirm", ja:"Á¢∫Ë™ç„Åô„Çã" },
      { en:"conserve", ja:"ÁØÄÁ¥Ñ„Åô„ÇãÔºõ‰øùÂ≠ò„Åô„Çã" }, { en:"consistent", ja:"‰∏ÄË≤´„Åó„ÅüÔºõÁüõÁõæ„ÅÆ„Å™„ÅÑ" },
      { en:"decline", ja:"Êñ≠„ÇãÔºõÊ∏õÂ∞ë„Åô„Çã" }, { en:"encourage", ja:"Âä±„Åæ„ÅôÔºõ‰øÉ„Åô" },
      { en:"evaluate", ja:"Ë©ï‰æ°„Åô„Çã" }, { en:"implement", ja:"ÂÆüË°å„Åô„ÇãÔºõÂÆüÊñΩ„Åô„Çã" },
      { en:"maintain", ja:"Á∂≠ÊåÅ„Åô„ÇãÔºõ‰∏ªÂºµ„Åô„Çã" }, { en:"suspend", ja:"‰∏ÄÊôÇÂÅúÊ≠¢„Åô„ÇãÔºõ‰øùÁïô„Å´„Åô„Çã" }
    ];

    const SENTENCES = [
      { en:"We need to allocate more time to training.", ja:"Á†î‰øÆ„Å´„ÇÇ„Å£„Å®ÊôÇÈñì„ÇíÂâ≤„ÇäÂΩì„Å¶„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ" },
      { en:"The parts are easy to assemble with the manual.", ja:"„Åù„ÅÆÈÉ®ÂìÅ„ÅØÂèñÊâ±Ë™¨ÊòéÊõ∏„ÅßÁ∞°Âçò„Å´ÁµÑ„ÅøÁ´ã„Å¶„Çâ„Çå„Åæ„Åô„ÄÇ" },
      { en:"Please confirm your attendance by Friday.", ja:"ÈáëÊõúÊó•„Åæ„Åß„Å´Âá∫Ê¨†„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ" },
      { en:"Sales declined slightly last quarter.", ja:"ÂÖàÂõõÂçäÊúü„Å´Â£≤‰∏ä„ÅØ„Çè„Åö„Åã„Å´Ê∏õÂ∞ë„Åó„Åæ„Åó„Åü„ÄÇ" },
      { en:"Her explanation clarified the policy.", ja:"ÂΩºÂ•≥„ÅÆË™¨Êòé„ÅßÊñπÈáù„ÅåÊòéÁ¢∫„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ" },
      { en:"The company authorized the refund.", ja:"‰ºöÁ§æ„ÅØËøîÈáë„ÇíÊâøË™ç„Åó„Åæ„Åó„Åü„ÄÇ" },
      { en:"Our factory operates at full capacity in summer.", ja:"ÂΩìÂ∑•Â†¥„ÅØÂ§è„Å´ÊúÄÂ§ßÁ®ºÂÉç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
      { en:"Be cautious when signing the contract.", ja:"Â•ëÁ¥Ñ„Å´ÁΩ≤Âêç„Åô„ÇãÈöõ„ÅØÊÖéÈáç„Å´„Å™„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ" },
      { en:"We will collaborate with a local supplier.", ja:"Âú∞ÂÖÉ„ÅÆ„Çµ„Éó„É©„Ç§„É§„Éº„Å®ÂçîÂäõ„Åó„Åæ„Åô„ÄÇ" },
      { en:"The report compiles data from three surveys.", ja:"„Åù„ÅÆÂ†±ÂëäÊõ∏„ÅØ3„Å§„ÅÆË™øÊüª„Åã„Çâ„ÅÆ„Éá„Éº„Çø„Çí„Åæ„Å®„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
      { en:"They implemented a new security system.", ja:"ÂΩº„Çâ„ÅØÊñ∞„Åó„ÅÑ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç∑„Çπ„ÉÜ„É†„ÇíÂÆüÊñΩ„Åó„Åæ„Åó„Åü„ÄÇ" },
      { en:"Please conserve energy after hours.", ja:"Âñ∂Ê•≠ÊôÇÈñìÂ§ñ„ÅØ„Ç®„Éç„É´„ÇÆ„Éº„ÇíÁØÄÁ¥Ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ" },
      { en:"We evaluate projects every quarter.", ja:"Êàë„ÄÖ„ÅØÂõõÂçäÊúü„Åî„Å®„Å´„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíË©ï‰æ°„Åó„Åæ„Åô„ÄÇ" },
      { en:"The machine requires regular maintenance.", ja:"„Åù„ÅÆÊ©üÊ¢∞„Å´„ÅØÂÆöÊúüÁöÑ„Å™‰øùÂÆà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ" },
      { en:"He assumed the role of team leader.", ja:"ÂΩº„ÅØ„ÉÅ„Éº„É†„É™„Éº„ÉÄ„Éº„ÅÆÂΩπÂâ≤„ÇíÂºï„ÅçÂèó„Åë„Åæ„Åó„Åü„ÄÇ" },
      { en:"Results remain consistent across tests.", ja:"ÁµêÊûú„ÅØ„ÉÜ„Çπ„ÉàÂÖ®‰Ωì„Åß‰∏ÄË≤´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
      { en:"The event was suspended due to the weather.", ja:"Â§©ÂÄô„ÅÆ„Åü„ÇÅ„Ç§„Éô„É≥„Éà„ÅØ‰∏ÄÊôÇ‰∏≠Ê≠¢„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ" },
      { en:"Encourage customers to leave feedback.", ja:"È°ßÂÆ¢„Å´„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅÆË®òÂÖ•„Çí‰øÉ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ" },
      { en:"We accomplished our yearly targets.", ja:"Âπ¥ÈñìÁõÆÊ®ô„ÇíÈÅîÊàê„Åó„Åæ„Åó„Åü„ÄÇ" },
      { en:"The estimate is approximately ten percent lower.", ja:"Ë¶ãÁ©ç„ÇÇ„Çä„ÅØ„Åä„Çà„Åù10%‰Ωé„Åè„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ" }
    ];

    const QA = [
      { q_en:"What does 'allocate' mean in project management?", a_en:"To assign resources, time, or money to tasks.", q_ja:"„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜ„Åß„ÅÆ„Äéallocate„Äè„ÅØ‰Ωï„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÅãÔºü", a_ja:"Ë≥áÊ∫ê„ÉªÊôÇÈñì„ÉªË≥áÈáë„Çí„Çø„Çπ„ÇØ„Å´Ââ≤„ÇäÂΩì„Å¶„Çã„Åì„Å®„ÄÇ" },
      { q_en:"When should you confirm a meeting?", a_en:"After the date/time is set and before the day of the meeting.", q_ja:"‰ºöË≠∞„ÅØ„ÅÑ„Å§Á¢∫Ë™ç„Åô„Åπ„Åç„Åß„Åô„ÅãÔºü", a_ja:"Êó•ÊôÇ„ÅåÊ±∫„Åæ„Å£„ÅüÂæå„Åß„ÄÅÂΩìÊó•„Çà„ÇäÂâç„Å´Á¢∫Ë™ç„Åô„Çã„ÄÇ" },
      { q_en:"Why conserve energy at the office?", a_en:"To reduce costs and environmental impact.", q_ja:"„Å™„Åú„Ç™„Éï„Ç£„Çπ„Åß„Ç®„Éç„É´„ÇÆ„Éº„ÇíÁØÄÁ¥Ñ„Åô„Çã„ÅÆ„Åß„Åô„ÅãÔºü", a_ja:"„Ç≥„Çπ„Éà„Å®Áí∞Â¢ÉË≤†Ëç∑„ÇíÊ∏õ„Çâ„Åô„Åü„ÇÅ„ÄÇ" },
      { q_en:"What is consistent performance?", a_en:"Results that are stable and reliable over time.", q_ja:"‰∏ÄË≤´„Åó„ÅüÊ•≠Á∏æ„Å®„ÅØÔºü", a_ja:"ÊôÇÈñì„ÅåÁµå„Å£„Å¶„ÇÇÂÆâÂÆö„Éª‰ø°È†º„Åß„Åç„ÇãÊàêÊûú„ÄÇ" },
      { q_en:"How do teams collaborate online?", a_en:"Using shared tools like chat, docs, and task boards.", q_ja:"„ÉÅ„Éº„É†„ÅØ„Ç™„É≥„É©„Ç§„É≥„Åß„Å©„ÅÜÂçîÂäõ„Åó„Åæ„Åô„ÅãÔºü", a_ja:"„ÉÅ„É£„ÉÉ„Éà„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÄÅ„Çø„Çπ„ÇØ„Éú„Éº„Éâ„Å™„Å©„ÅÆÂÖ±Êúâ„ÉÑ„Éº„É´„Çí‰Ωø„ÅÜ„ÄÇ" },
      { q_en:"What does it mean to implement a plan?", a_en:"To execute it in practice.", q_ja:"Ë®àÁîª„ÇíÂÆüË°å„Åô„Çã„Å®„ÅØÔºü", a_ja:"ÂÆüÈöõ„Å´ÂÆüË°å„Åô„Çã„Åì„Å®„ÄÇ" },
      { q_en:"When might a company suspend operations?", a_en:"During emergencies or system maintenance.", q_ja:"‰ºöÁ§æ„ÅåÊ•≠Âãô„ÇíÂÅúÊ≠¢„Åô„Çã„ÅÆ„ÅØ„ÅÑ„Å§Ôºü", a_ja:"Á∑äÊÄ•ÊôÇ„ÇÑ„Ç∑„Çπ„ÉÜ„É†‰øùÂÆà„ÅÆÈñì„ÄÇ" },
      { q_en:"How do you evaluate a vendor?", a_en:"By price, quality, reliability, and service.", q_ja:"„Éô„É≥„ÉÄ„Éº„Çí„Å©„ÅÜË©ï‰æ°„Åó„Åæ„Åô„ÅãÔºü", a_ja:"‰æ°Ê†º„ÉªÂìÅË≥™„Éª‰ø°È†ºÊÄß„Éª„Çµ„Éº„Éì„Çπ„ÅßË©ï‰æ°„Åô„Çã„ÄÇ" },
      { q_en:"What does 'assume responsibility' imply?", a_en:"You accept the duty and its consequences.", q_ja:"„ÄéË≤¨‰ªª„ÇíÂºï„ÅçÂèó„Åë„Çã„Äè„Å®„ÅØÔºü", a_ja:"Ë≤¨‰ªª„Å®„Åù„ÅÆÁµêÊûú„ÇíÂºï„ÅçÂèó„Åë„Çã„Åì„Å®„ÄÇ" },
      { q_en:"What is the capacity of a venue?", a_en:"The maximum number of people it can hold.", q_ja:"‰ºöÂ†¥„ÅÆÂèéÂÆπ‰∫∫Êï∞„Å®„ÅØÔºü", a_ja:"ÂèéÂÆπÂèØËÉΩ„Å™ÊúÄÂ§ß‰∫∫Êï∞„ÄÇ" },
      { q_en:"Why clarify instructions?", a_en:"To prevent mistakes and delays.", q_ja:"ÊåáÁ§∫„ÇíÊòéÁ¢∫„Å´„Åô„ÇãÁêÜÁî±„ÅØÔºü", a_ja:"„Éü„Çπ„Å®ÈÅÖÂª∂„ÇíÈò≤„Åê„Åü„ÇÅ„ÄÇ" },
      { q_en:"How can managers encourage staff?", a_en:"By recognizing efforts and offering support.", q_ja:"ÁÆ°ÁêÜËÅ∑„ÅØ„Å©„ÅÜ„ÇÑ„Å£„Å¶ËÅ∑Âì°„ÇíÂä±„Åæ„ÅôÔºü", a_ja:"Âä™Âäõ„ÇíË™ç„ÇÅ„ÄÅÊîØÊè¥„ÇíÊèê‰æõ„Åô„Çã„ÄÇ" },
      { q_en:"What does 'compile a report' involve?", a_en:"Collecting and organizing information.", q_ja:"„ÄéÂ†±ÂëäÊõ∏„Çí„Åæ„Å®„ÇÅ„Çã„Äè„Å®„ÅØÔºü", a_ja:"ÊÉÖÂ†±„ÇíÂèéÈõÜ„ÅóÊï¥ÁêÜ„Åô„Çã„Åì„Å®„ÄÇ" },
      { q_en:"When do sales typically decline?", a_en:"During off-peak seasons or recessions.", q_ja:"Â£≤‰∏ä„ÅåËêΩ„Å°„ÇÑ„Åô„ÅÑÊôÇÊúü„ÅØÔºü", a_ja:"ÈñëÊï£Êúü„ÇÑ‰∏çÊ≥Å„ÅÆ„Å®„Åç„ÄÇ" },
      { q_en:"What is approximately ten minutes?", a_en:"About eight to twelve minutes.", q_ja:"„ÄéÁ¥Ñ10ÂàÜ„Äè„Å®„ÅØÔºü", a_ja:"8„Äú12ÂàÜÁ®ãÂ∫¶„ÄÇ" },
      { q_en:"Why be cautious with emails?", a_en:"To avoid scams and data leaks.", q_ja:"„É°„Éº„É´„Å´Ê≥®ÊÑè„Åô„Åπ„ÅçÁêÜÁî±„ÅØÔºü", a_ja:"Ë©êÊ¨∫„ÇÑÊÉÖÂ†±Êºè„Åà„ÅÑ„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÇ" },
      { q_en:"How do you maintain equipment?", a_en:"Clean, inspect, and service it regularly.", q_ja:"Ë®≠ÂÇô„ÅÆÁ∂≠ÊåÅÊñπÊ≥ï„ÅØÔºü", a_ja:"ÂÆöÊúüÁöÑ„Å´Ê∏ÖÊéÉ„ÉªÁÇπÊ§ú„ÉªÊï¥ÂÇô„Åô„Çã„ÄÇ" },
      { q_en:"Who can authorize expenses?", a_en:"Supervisors or finance departments.", q_ja:"Ë≤ªÁî®„ÇíÊâøË™ç„Åß„Åç„Çã„ÅÆ„ÅØË™∞Ôºü", a_ja:"‰∏äÈï∑„ÇÑÁµåÁêÜÈÉ®ÈñÄ„ÄÇ" },
      { q_en:"What does 'accomplish a task' mean?", a_en:"Finish it successfully.", q_ja:"„Äé„Çø„Çπ„ÇØ„ÇíÈÅîÊàê„Åô„Çã„Äè„Å®„ÅØÔºü", a_ja:"„ÅÜ„Åæ„Åè„ÇÑ„ÇäÈÅÇ„Åí„Çã„Åì„Å®„ÄÇ" },
      { q_en:"What happens when teams fail to collaborate?", a_en:"Work is duplicated and deadlines are missed.", q_ja:"ÂçîÂäõ„Åß„Åç„Å™„ÅÑ„Å®‰Ωï„ÅåËµ∑„Åç„ÇãÔºü", a_ja:"‰ΩúÊ•≠„ÅÆÈáçË§á„ÇÑÁ∑†ÂàáÈÅÖÂª∂„ÅåËµ∑„Åç„Çã„ÄÇ" }
    ];

    const QUIZ = [
      { q:"'Allocate' is closest in meaning to:", options:["distribute","repair","delay","dismiss"], answer:0, ja:"„Äéallocate„Äè„Å´ÊúÄ„ÇÇËøë„ÅÑÊÑèÂë≥„ÅØÔºü" },
      { q:"'Approximately' means:", options:["exactly","about","rarely","equally"], answer:1, ja:"„Äéapproximately„Äè„ÅÆÊÑèÂë≥„ÅØÔºü" },
      { q:"To 'assemble' equipment is to:", options:["store it","build it","ship it","return it"], answer:1, ja:"Ê©üÂô®„Çí„Äéassemble„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"'Authorize' most nearly means:", options:["approve","argue","announce","avoid"], answer:0, ja:"„Äéauthorize„Äè„ÅÆÊÑèÂë≥„Å´ÊúÄ„ÇÇËøë„ÅÑ„ÅÆ„ÅØÔºü" },
      { q:"'Capacity' refers to:", options:["cost of labor","maximum ability","average time","customer review"], answer:1, ja:"„Äécapacity„Äè„ÅØ‰Ωï„ÇíÊåá„ÅôÔºü" },
      { q:"A 'cautious' approach is:", options:["careless","patient","careful","creative"], answer:2, ja:"„Äécautious„Äè„Å™„Ç¢„Éó„É≠„Éº„ÉÅ„ÅØÔºü" },
      { q:"To 'clarify' instructions is to:", options:["shorten them","make them clear","ignore them","translate them"], answer:1, ja:"ÊåáÁ§∫„Çí„Äéclarify„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"Teams 'collaborate' when they:", options:["compete","work together","rotate jobs","work overtime"], answer:1, ja:"„ÉÅ„Éº„É†„Åå„Äécollaborate„Äè„Åô„Çã„ÅÆ„ÅØÔºü" },
      { q:"To 'compile' data means to:", options:["delete it","compare it","collect it","share it"], answer:2, ja:"„Éá„Éº„Çø„Çí„Äécompile„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'confirm' an order is to:", options:["cancel it","verify it","ship it","print it"], answer:1, ja:"Ê≥®Êñá„Çí„Äéconfirm„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'conserve' resources is to:", options:["save them","spend them","waste them","audit them"], answer:0, ja:"Ë≥áÊ∫ê„Çí„Äéconserve„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"'Consistent' results are:", options:["irregular","similar over time","unexpected","declining"], answer:1, ja:"„Äéconsistent„Äè„Å™ÁµêÊûú„Å®„ÅØÔºü" },
      { q:"To 'decline' an invitation is to:", options:["accept","postpone","refuse","repeat"], answer:2, ja:"ÊãõÂæÖ„Çí„Äédecline„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'encourage' staff is to:", options:["criticize","motivate","replace","observe"], answer:1, ja:"ËÅ∑Âì°„Çí„Äéencourage„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'evaluate' a program is to:", options:["guess","measure","announce","install"], answer:1, ja:"„Éó„É≠„Ç∞„É©„É†„Çí„Äéevaluate„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'implement' a policy is to:", options:["plan it","discuss it","enforce it","oppose it"], answer:2, ja:"ÊñπÈáù„Çí„Äéimplement„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'maintain' equipment is to:", options:["ignore","repair regularly","sell","relocate"], answer:1, ja:"Ë®≠ÂÇô„Çí„Äémaintain„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'assume' a role is to:", options:["reject it","take it on","criticize it","limit it"], answer:1, ja:"ÂΩπÂâ≤„Çí„Äéassume„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'suspend' service is to:", options:["reduce cost","improve quality","pause temporarily","expand rapidly"], answer:2, ja:"„Çµ„Éº„Éì„Çπ„Çí„Äésuspend„Äè„Åô„Çã„Å®„ÅØÔºü" },
      { q:"To 'accomplish' a goal is to:", options:["begin it","delay it","achieve it","question it"], answer:2, ja:"ÁõÆÊ®ô„Çí„Äéaccomplish„Äè„Åô„Çã„Å®„ÅØÔºü" }
    ];

    const READING = [{ en:"Reading passage coming soon‚Ä¶", ja:"Ê∫ñÂÇô‰∏≠‚Ä¶" }];

    // 1.jpg..20.jpg and assets/A1.m4a..A20.m4a
    const QA_IMAGES = Array.from({length:20}, (_,i)=> `${i+1}.jpg`);
    const QA_AUDIOS = Array.from({length:20}, (_,i)=> `assets/A${i+1}.m4a`);

    // -------------- State --------------
    let deck = [];
    let index = 0;
    let showingFront = true;

    const els = {
      welcome: document.getElementById('welcome'),
      startBtn: document.getElementById('startBtn'),
      app: document.getElementById('app'),
      mode: document.getElementById('mode'),
      card: document.getElementById('card'),
      label: document.getElementById('label'),
      main: document.getElementById('main'),
      sub: document.getElementById('sub'),
      hira: document.getElementById('hira'),
      counter: document.getElementById('counter'),
      bar: document.getElementById('bar'),
      btnPrev: document.getElementById('btnPrev'),
      btnNext: document.getElementById('btnNext'),
      btnFlip: document.getElementById('btnFlip'),
      btnShuffle: document.getElementById('btnShuffle'),
      mcArea: document.getElementById('mcArea'),
      pic: document.getElementById('pic'),
      // QA audio
      btnPlay: document.getElementById('btnPlay'),
      btnSpeed: document.getElementById('btnSpeed'),
      qaAudio: document.getElementById('qaAudio'),
    };

    function shuffle(arr){ for(let i=arr.length-1;i>0;i++){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }
    function showQAControls(show){
      document.querySelectorAll('.qaOnly').forEach(el=>{ el.style.display = show ? '' : 'none'; });
      // Enable/disable play button based on audio availability
      if(show && deck.length){
        const hasAudio = !!deck[index].audio;
        els.btnPlay.disabled = !hasAudio;
        els.btnSpeed.disabled = !hasAudio;
      }
      if(!show){ els.qaAudio.pause(); els.btnPlay.classList.remove('playing'); els.btnPlay.classList.add('paused'); }
    }

    // Build decks
    function buildDeck(){
      const mode = els.mode.value;
      if(mode==='vocab-j2e' || mode==='vocab-e2j'){
        deck = VOCAB.map(x=>({
          type:'vocab',
          front: mode==='vocab-j2e' ? x.ja : x.en,
          back:  mode==='vocab-j2e' ? x.en : x.ja,
          sideLabelFront: mode==='vocab-j2e' ? 'Japanese ‚Üí English' : 'English ‚Üí Japanese',
          sideLabelBack:  mode==='vocab-j2e' ? 'English' : 'Japanese',
        }));
      } else if(mode==='sentences'){
        deck = SENTENCES.map(s=>({
          type:'sentence',
          front: s.ja,
          back: s.en + '\n' + s.ja,
          sideLabelFront: 'Japanese sentence',
          sideLabelBack: 'Answer (EN + JA)',
        }));
      } else if(mode==='qa'){
        deck = QA.map((q,i)=>({
          type:'qa',
          front: q.q_ja || q.q_en,
          back: (q.a_en||'') + (q.a_ja ? '\n' + q.a_ja : ''),
          sideLabelFront: (q.q_ja ? 'Question (JA)' : 'Question (EN)'),
          sideLabelBack: 'Answer (EN + JA)',
          img: QA_IMAGES[i] || null,
          audio: QA_AUDIOS[i] || null
        }));
      } else if(mode==='quiz'){
        deck = QUIZ.map(q=>({
          type:'quiz4',
          front: q.q,
          back: (q.ja ? q.ja + '\n' : '') + 'Answer: ' + q.options[q.answer],
          options: q.options,
          answer: q.answer,
          sideLabelFront: 'Choose the best answer',
          sideLabelBack: 'Explanation',
        }));
      } else if(mode==='reading'){
        deck = READING.map(r=>({
          type:'reading',
          front: r.en,
          back: r.en + '\n' + r.ja,
          sideLabelFront: 'Reading (EN)',
          sideLabelBack: 'Reading (EN + JA)',
        }));
      }
      index = 0; showingFront = true; render();
    }

    // QA Audio handling
    const SPEEDS = [0.5, 0.8, 1.0];
    let speedIdx = 2; // 1.0x

    function updateQAAudio(){
      if(els.mode.value!=='qa' || deck.length===0) return;
      const item = deck[index];
      const src = item.audio;
      // Guard: if missing audio, disable controls gracefully
      if(!src){ els.qaAudio.removeAttribute('src'); els.btnPlay.disabled = true; els.btnSpeed.disabled = true; return; }
      els.btnPlay.disabled = false; els.btnSpeed.disabled = false;

      const wasPlaying = !els.qaAudio.paused && !els.qaAudio.ended;
      if(els.qaAudio.src !== (new URL(src, location.href)).href){
        els.qaAudio.src = src;
      }
      els.qaAudio.playbackRate = SPEEDS[speedIdx];
      if(wasPlaying){
        els.qaAudio.play().catch(()=>{ /* iOS will require a tap again */ });
      }
    }

    function setPlayButtonState(){
      if(els.qaAudio.paused) { els.btnPlay.classList.remove('playing'); els.btnPlay.classList.add('paused'); }
      else { els.btnPlay.classList.remove('paused'); els.btnPlay.classList.add('playing'); }
    }

    // Render
    function render(){
      if(deck.length===0){
        els.main.textContent='‚Äî'; els.sub.textContent='No cards'; els.counter.textContent='0 / 0'; showQAControls(false); return;
      }
      const item = deck[index];
      const mode = els.mode.value;
      els.label.textContent = showingFront ? item.sideLabelFront : item.sideLabelBack;

      // Picture (QA only; show when available)
      if(item.img){
        els.pic.classList.remove('hidden');
        els.pic.src = item.img;
        els.pic.alt = item.sideLabelFront || 'illustration';
        els.pic.onerror = ()=>{ els.pic.classList.add('hidden'); };
      } else {
        els.pic.classList.add('hidden'); els.pic.removeAttribute('src');
      }

      // Text
      const content = showingFront ? item.front : item.back;
      if((!showingFront) && (item.type==='qa' || item.type==='sentence' || item.type==='reading') && content.includes('\n')){
        const [line1, line2] = content.split('\n');
        els.main.innerHTML = `<div style="font-size:22px;font-weight:700" class="${item.type==='reading'?'small':''}">${line1}</div>
                              <div class="sub ${item.type==='reading'?'small':''}" style="margin-top:8px">${line2}</div>`;
      } else {
        els.main.innerHTML = `<div class="${item.type==='reading'?'small':''}">${content}</div>`;
      }

      // Quiz front behavior
      if(mode==='quiz' && item.type==='quiz4' && showingFront){
        els.sub.textContent = 'Choose the correct answer.';
        els.mcArea.classList.remove('hidden'); els.mcArea.innerHTML = '';
        item.options.forEach((opt, i)=>{
          const btn = document.createElement('button');
          btn.className = 'optbtn'; btn.textContent = opt;
          btn.addEventListener('click', (e)=>{
            e.preventDefault(); e.stopPropagation();
            if(i !== item.answer){ btn.classList.add('bad'); btn.disabled = true; return; }
            btn.classList.add('ok'); [...els.mcArea.querySelectorAll('button')].forEach(b=>b.disabled=true);
            setTimeout(()=>{ showingFront = false; render(); }, 250);
          }, { passive:false });
          els.mcArea.appendChild(btn);
        });
      } else {
        els.mcArea.classList.add('hidden'); els.mcArea.innerHTML = '';
        els.sub.textContent = (item.type==='quiz4' && showingFront) ? 'Choose the correct answer.' : 'Tap / Space to flip ¬∑ Swipe / ‚Üê ‚Üí to navigate';
      }

      // QA controls
      if(mode==='qa'){
        showQAControls(true);
        els.btnSpeed.textContent = `${SPEEDS[speedIdx].toFixed(1)}√ó`;
        updateQAAudio();
        setPlayButtonState();
      } else {
        showQAControls(false);
      }

      // Footer
      els.counter.textContent = `${index+1} / ${deck.length}`;
      const pct = ((index+1)/deck.length)*100;
      let bar = document.getElementById('bar');
      if(!bar){
        const p = document.querySelector('.progress');
        bar = document.createElement('span'); bar.id='bar'; p.appendChild(bar);
      }
      bar.style.width = `${pct}%`;

      setHash();
    }

    // Nav
    function prev(){ index = (index-1+deck.length)%deck.length; showingFront=true; render(); }
    function next(){ index = (index+1)%deck.length; showingFront=true; render(); }
    function flip(){ 
      // In QA mode, Space toggles Play; clicking the card still flips
      showingFront = !showingFront; 
      render(); 
    }
    function shuffleDeck(){ deck = shuffle(deck); index=0; showingFront=true; render(); }

    // URL hash
    function setHash(){ location.hash = `#${els.mode.value}:${index}`; }
    function readHash(){
      const h = location.hash.replace('#','');
      if(!h){ buildDeck(); return; }
      const [m, i] = h.split(':');
      if(m && [...els.mode.options].some(o=>o.value===m)) els.mode.value = m;
      buildDeck();
      if(i && !Number.isNaN(+i)) index = Math.max(0, Math.min(deck.length-1, +i));
      render();
    }

    // Events
    els.mode.addEventListener('change', ()=>{ buildDeck(); setHash(); });
    document.getElementById('btnPrev').addEventListener('click', prev);
    document.getElementById('btnNext').addEventListener('click', next);
    document.getElementById('btnFlip').addEventListener('click', flip);
    document.getElementById('btnShuffle').addEventListener('click', shuffleDeck);

    // QA play/pause & speed
    els.btnPlay.addEventListener('click', (e)=>{
      e.preventDefault();
      if(els.qaAudio.paused){ els.qaAudio.play().then(()=> setPlayButtonState()).catch(()=>{}); }
      else { els.qaAudio.pause(); setPlayButtonState(); }
    });
    els.btnSpeed.addEventListener('click', (e)=>{
      e.preventDefault();
      speedIdx = (speedIdx+1) % SPEEDS.length;
      els.qaAudio.playbackRate = SPEEDS[speedIdx];
      els.btnSpeed.textContent = `${SPEEDS[speedIdx].toFixed(1)}√ó`;
    });
    ['play','pause','ended'].forEach(ev=> els.qaAudio.addEventListener(ev, setPlayButtonState));

    // Keyboard
    window.addEventListener('keydown', (e)=>{
      if(e.code==='ArrowLeft'){ e.preventDefault(); prev(); }
      else if(e.code==='ArrowRight'){ e.preventDefault(); next(); }
      else if(e.code==='Space'){
        if(els.mode.value==='qa'){ e.preventDefault(); els.btnPlay.click(); }
        else { e.preventDefault(); if(!(els.mode.value==='quiz' && showingFront)) flip(); }
      } else if(['1','2','3','4'].includes(e.key) && els.mode.value==='quiz' && showingFront){
        const i = parseInt(e.key,10)-1; const b=els.mcArea.querySelectorAll('button')[i]; if(b) b.click();
      }
    });

    // Click/Touch to flip (avoid clicks on QA controls and picture)
    document.getElementById('card').addEventListener('click', (e)=>{
      if(els.mode.value==='quiz' && showingFront) return;
      if(e.target.closest('#btnPlay') || e.target.closest('#btnSpeed') || e.target.id==='pic') return;
      flip();
    }, { passive:true });

    // Swipe
    let touchStartX=null, touchStartY=null;
    document.getElementById('card').addEventListener('touchstart', (e)=>{
      const t=e.changedTouches[0]; touchStartX=t.clientX; touchStartY=t.clientY;
    }, {passive:true});
    document.getElementById('card').addEventListener('touchend', (e)=>{
      const t=e.changedTouches[0]; if(touchStartX===null) return;
      const dx=t.clientX - touchStartX; const dy=t.clientY - touchStartY;
      if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)){ if(dx>0) prev(); else next(); }
      else if(Math.abs(dy)<10 && Math.abs(dx)<10){ if(!(els.mode.value==='quiz' && showingFront)) flip(); }
      touchStartX=touchStartY=null;
    }, {passive:true});

    // Start overlay
    document.getElementById('startBtn').addEventListener('click', ()=>{
      els.welcome.classList.add('hidden');
      els.app.classList.remove('hidden');
      readHash(); // build + render
    });

    // Init (if user loads with hash, we‚Äôll build after Start)
  </script>
</body>
</html>
